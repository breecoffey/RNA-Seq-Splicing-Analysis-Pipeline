## A brief Anthill tutorial with test data

This worked out example will take you through the basics of using the anthill pipeline. The dependencies necessary are shown in the README. All must be in your PATH. Clone this git repo and head to the `test_example` directory.

Now, select your data. We have chosen .bam files from the compbio server for this purpose. These .bam files can be found [here](https://www.ebi.ac.uk/arrayexpress/experiments/E-GEUV-1/). Within this test_example directory, you will find a text file called example_bams.txt. Opening it shows the following  
<details>
<summary>.bam files:</summary>
<p>
HG00133.2.M_111216_2.bam   
HG00324.1.M_111124_2.bam   
HG00326.1.M_111124_7.bam   
NA07051.5.M_120131_1.bam   
NA19209.6.M_120217_1.bam   
NA20519.1.M_111124_5.bam   
</p>
</details>  
    

If you are on the compbio server, these files are readily available within the directory 
```
/homes/hwheeler/Data/gEUVADIS_RNASeq
```
You can copy them all to your directory using:

```
while read line; do cp /homes/hwheeler/Data/gEUVADIS_RNASeq/$line /path/to/test_example; done < example_bams.txt
```

__Note__: You need to place all scripts within the same directory as the .bam data, not in an adjacent, sub, or parent directory.

We now want to calculate intron excision ratios run the leaf-command script. To execute the script, use the location of your bamfiles and the location of your leafcutter install directory as arguments
```
./leaf-command /path/to/bamfiles /path/to/leafcutter
```

__Note__: This step can take roughly an hour for this example, even longer with additional files. If you do not wish to wait around and keep your connection active on a remote host, you can use the `nohup` command.
The qqnorm files generated from this command contain the intron excision ratios for each chromosome. 

Next, we want to parse our VCF files which contain the SNP information. Parsing any VCF file to output the genotype information takes some time we have provided a parsed example for you in SNPGenotypes_chr22 & SNPLoc_22.

SNP genotype files need to be further processed to match the gene expression files generated by leafcutter. For our example, it should look like this:
```
python file_order.py /path/to/SNPGenotypes_chr22 /path/to/Gene_expression_chr22
```
The file will output as ```ReorderedSNPGenotypes_chr22```. For general use, the first argument is the SNP Genotypes and the second is the Gene expression file from leafcutter output.

Now, we can run Matrix eQTL. The first argument should point to the directory where all these files exist:
```
Rscript matrix_eQTL.R /path/to/test_data/ finalSNPGenotypes_chr22 SNPLoc_chr22 Gene_expression_chr22 Gene_location_chr22
```

For general use, the second argument should be the final SNP Genotypes, third is SNP Location, fourth is Gene expression, and fifth is Gene location.  
Your output will be statistically significant sQTLs in the cis and trans output files. Additionally, a pdf will be generated of a histogram showing the p values of the SNPs and the quantity. 
